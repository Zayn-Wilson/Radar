# 比赛操作流程指南

本文档详细说明了比赛前的准备工作、标定流程、运行程序以及界面元素的含义，用于指导参赛人员进行正确操作。

## 一、比赛前准备

### 1. 阵营确认

在开始标定前，需要确定您的阵营（红方R或蓝方B）：

- 打开`calibration.py`文件，找到state变量，根据分配修改：
  - 红方：将值修改为`'R'`
  - 蓝方：将值修改为`'B'`（默认）

### 2. 相机模式确认

在`calibration.py`中确保相机模式设置正确：
- 'test': 测试模式
- 'hik': 海康相机
- 'video': USB相机

### 3. 环境检查

- 确保相机固定在正确位置且连接正常
- 确保串口设备已正确连接
- 确认GPU加速可用（如使用GPU）

## 二、标定步骤详解

### 1. 启动标定程序

运行`calibration.py`程序，界面将显示左侧的相机实时图像和右侧的地图图像。

### 2. 标定地面层/公路区 (高度0)

1. **开始标定**:
   - 点击界面右下角的**"开始标定"**按钮
   - 相机画面将被冻结

2. **标定左侧相机图像**:
   - 在左侧相机图像中选择4个公路区域的特征点
   - 系统会用**白色圆圈**标记，并显示序号(0-3)

3. **标定右侧地图图像**:
   - 在右侧地图中选择对应的4个点（按相同顺序）
   - 系统同样用白色圆圈标记这些点

### 3. 标定R型高地 (高度1)

1. **切换高度**:
   - 点击**"切换高度"**按钮（高度值从0变为1）

2. **标定左右图像**:
   - 在左侧选择4个R型高地区域的特征点
   - 在右侧选择对应的4个点
   - 系统会用**绿色圆圈**标记这些点

### 4. 标定环形高地 (高度2)

1. **再次切换高度**:
   - 再次点击**"切换高度"**按钮（高度值从1变为2）

2. **标定左右图像**:
   - 在左侧选择4个环形高地区域的特征点
   - 在右侧选择对应的4个点
   - 系统会用**蓝色圆圈**标记这些点

### 5. 保存计算结果

- 完成所有3个高度层的标定后，点击**"保存计算"**按钮
- 系统将计算仿射变换矩阵并保存：
  - 红方：`arrays_test_red.npy`
  - 蓝方：`arrays_test_blue.npy`
- 保存完成后程序将自动退出

## 三、运行主程序

### 1. 修改main.py配置

标定完成后，需要确保`main.py`的配置与标定时一致：

1. **阵营设置**:
   - 打开`main.py`，确认state变量与标定时一致

2. **相机模式**:
   - 确认camera_mode设置正确

3. **串口设置**:
   - 确认串口设备名与实际一致

### 2. 启动主程序

运行`main.py`程序

### 3. 运行检查

运行后确认以下功能是否正常：
- 机器人识别和位置映射是否准确
- 地图上的标记是否正确显示
- 条形图信息是否正常更新
- 双倍易伤功能是否正常工作

## 四、界面元素解释

### 1. 主要窗口

主程序运行后会显示三个窗口：
- **img**: 显示相机实时画面及识别结果
- **map**: 显示战场地图与机器人位置
- **information_ui**: 显示战场信息和状态

### 2. 条形图(Bar)显示

条形图位于左侧面板下方，表示机器人血量/能量状态：

- **分组显示**:
  - `OUR_blue`: 我方（蓝方）机器人
  - `ENEMY_red`: 敌方（红方）机器人

- **机器人编号**:
  - B1-B7: 蓝方的7个机器人
  - R1-R7: 红方的7个机器人

- **绿色条形图**:
  - 每个机器人对应一个绿色条形图
  - 条形图长度表示当前血量/能量值
  - "500"表示满血量值

### 3. 地图(Map)显示

地图窗口展示战场俯视图及机器人位置：

- **机器人标记**:
  - 红色圆圈: 红方机器人
  - 蓝色圆圈: 蓝方机器人
  - 圆圈中的文字: 机器人ID
  - 圆圈下方的坐标: 机器人实际坐标(x,y)

- **视角**:
  - 根据`state`变量不同，地图视角会有所不同
  - 红方视角: 使用`map_red.jpg`
  - 蓝方视角: 使用`map_blue.jpg`

### 4. 状态信息

information_ui窗口显示以下状态信息：

- **Vulnerability_chances**: 
  - 表示当前拥有的"双倍易伤"触发机会数量
  - 数值大于0表示可以触发双倍易伤

- **Vulnerability_Triggering**: 
  - 表示当前是否已激活双倍易伤效果
  - 0: 未触发
  - 1: 已触发

## 五、常见问题与解决

1. **标定不准确**:
   - 重新选择更明显的特征点进行标定
   - 确保点的分布更均匀，覆盖更大范围

2. **机器人识别问题**:
   - 检查相机曝光设置是否与标定时一致
   - 确认模型文件是否正确加载

3. **串口通信问题**:
   - 检查串口设备是否正确连接
   - 确认串口名称是否正确设置

4. **性能问题**:
   - 检查GPU是否正常工作
   - 考虑将模型转换为TensorRT格式提升性能
