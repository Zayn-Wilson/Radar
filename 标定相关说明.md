# 相机标定说明文档

## 概述

本文档详细说明了相机标定系统的使用方法，包括标定流程、标定点数、高度切换以及其他注意事项。正确完成标定过程对于系统准确识别战场上机器人位置至关重要。

## 标定基本信息

- **标定高度层数**：共需标定3个高度层
  - 高度0：地面层/公路层（白色标记）
  - 高度1：R型高地（绿色标记）
  - 高度2：环形高地（蓝色标记）

- **每个高度层标定点数**：每个高度层需标定4个点
  - 左侧相机图像中标记4个点
  - 右侧地图图像中标记对应的4个点

- **总标定点数**：共计12对点（3个高度 × 4个点）

## 标定详细流程

### 1. 启动标定程序

运行`calibration.py`程序，界面将显示左侧的相机实时图像和右侧的地图图像。

### 2. 开始标定

1. 点击界面右下角的**"开始标定"**按钮
2. 此时相机画面将被冻结，便于进行精确标点

### 3. 标定第一个高度层（地面层/公路层）

1. **在左侧相机图像上标点**：
   - 点击图像中地面层上的4个特征点
   - 系统会用白色标记这些点，并显示序号(0-3)
   - 每次点击后，坐标信息会显示在文本框中

2. **在右侧地图图像上标点**：
   - 点击地图上与左侧相机图像中对应的4个点
   - 确保点的对应关系正确（序号0-3对应）
   - 系统同样会用白色标记并显示序号

### 4. 切换到下一个高度层

1. 点击**"切换高度"**按钮，高度值将从0变为1（R型高地）
2. 界面会显示"切换高度"提示，计数器会重置

### 5. 标定第二个高度层（R型高地）

1. 按照步骤3的方法，在左侧相机图像和右侧地图上各标记4个点
2. 此时系统会用绿色标记这些点

### 6. 再次切换高度

1. 点击**"切换高度"**按钮，高度值将从1变为2（环形高地）

### 7. 标定第三个高度层（环形高地）

1. 按照相同的方法，在左侧相机图像和右侧地图上各标记4个点
2. 此时系统会用蓝色标记这些点

### 8. 保存计算结果

1. 完成所有3个高度层的标定后，点击**"保存计算"**按钮
2. 系统将计算仿射变换矩阵并保存到指定文件中（取决于当前状态，红方为`arrays_test_red.npy`，蓝方为`arrays_test_blue.npy`）
3. 保存完成后程序将自动退出

## 标定注意事项

1. **标定点选择**：
   - 选择容易识别的特征点，如角落、交叉点等
   - 四个点应尽量分布在画面的不同区域，形成一个四边形
   - 避免选择三点共线或四点共面的情况

2. **对应关系**：
   - 确保左侧相机图像和右侧地图图像中的点一一对应
   - 点击的顺序很重要，需要保持一致

3. **高度区分**：
   - 不同高度层使用不同颜色标记，便于区分
   - 标定时应明确当前正在标定的高度层

4. **精确度要求**：
   - 标定点应尽可能精确，误差会直接影响系统识别的准确性
   - 可以利用界面放大功能（如果有）来提高点选精度

5. **红蓝方区分**：
   - 程序会根据当前设置（R或B）保存到不同的文件
   - 确保为正确的方保存标定结果

## 标定文件用途

完成标定后生成的`.npy`文件包含三个仿射变换矩阵，分别用于：

1. 地面层/公路层坐标转换
2. R型高地坐标转换
3. 环形高地坐标转换

这些矩阵在主程序(`main.py`)中用于将相机捕获的二维图像坐标转换为实际战场地图中的坐标，从而准确定位机器人位置。

## 故障排除

1. 如果标定结果不准确，可重新运行程序进行标定
2. 确保相机位置固定，标定后不要移动相机
3. 如需更新标定数据，请完整重新标定所有高度层 